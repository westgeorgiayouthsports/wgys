{
  "rules": {
    "announcements": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      "$announcementId": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "sports": {
      ".read": true,
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".indexOn": ["name","ageControlDate"],
      "$sportId": {
        ".read": true,
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".validate": "newData.hasChildren(['name','ageControlDate'])",
        "name": { ".validate": "newData.isString() && newData.val().length > 1" },
        "ageControlDate": { ".validate": "newData.isString() && newData.val().length == 5" }
      }
    },
    "comments": {
      ".read": "auth != null",
      "$announcementId": {
        ".read": "auth != null",
        ".write": "auth != null",
        "$commentId": {
          ".read": "auth != null",
          ".write": "auth != null"
        }
      }
    },
    "users": {
      ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      "$userId": {
        ".read": "auth != null && (auth.uid == $userId || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": "auth != null && (auth.uid == $userId || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "teams": {
      ".read": "auth != null",
      ".write": "auth != null",
      ".indexOn": ["programId"],
      "$teamId": {
        ".read": "auth != null",
        ".write": "auth != null && (data.child('userId').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "people": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$personId": {
        ".read": "auth != null",
        ".write": "auth != null && (data.child('userId').val() == auth.uid || data.child('createdBy').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "families": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$familyId": {
        ".read": "auth != null",
        ".write": "auth != null && (data.child('createdBy').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "familyFiles": {
      "$familyId": {
        ".read": "auth != null && (\n          root.child('users').child(auth.uid).child('role').val() == 'admin' ||\n          root.child('users').child(auth.uid).child('role').val() == 'owner' ||\n          (root.child('users_to_person').child(auth.uid).exists() && root.child('people').child(root.child('users_to_person').child(auth.uid).val()).child('familyId').val() == $familyId)\n        )",
        ".write": "auth != null && (\n          root.child('users').child(auth.uid).child('role').val() == 'admin' ||\n          root.child('users').child(auth.uid).child('role').val() == 'owner' ||\n          (root.child('users_to_person').child(auth.uid).exists() && root.child('people').child(root.child('users_to_person').child(auth.uid).val()).child('familyId').val() == $familyId)\n        )"
      }
    },
    "programs": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".indexOn": ["seasonId"],
      "$programId": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },

    "programTemplates": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      "$tplId": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".validate": "newData.hasChildren(['sportId','programType'])",
        "sportId": { ".validate": "newData.isString() && newData.val().length > 0" },
        "programType": { ".validate": "newData.isString() && (newData.val() == 'recreation' || newData.val() == 'select' || newData.val() == 'sport' || newData.val() == 'lesson' || newData.val() == 'training' || newData.val() == 'tryout' || newData.val() == 'camp')" },
        "sex": { ".validate": "newData.val() == null || (newData.isString() && (newData.val() == 'any' || newData.val() == 'male' || newData.val() == 'female'))" },
        "defaultMinAge": { ".validate": "newData.val() == null || newData.isNumber()" },
        "defaultMaxAge": { ".validate": "newData.val() == null || newData.isNumber()" },
        "defaultBaseFee": { ".validate": "newData.val() == null || newData.isNumber()" },
        "active": { ".validate": "newData.val() == null || newData.isBoolean()" }
      }
    },
    "discounts": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      "$discountId": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "seasons": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      "$seasonId": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "paymentPlans": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      "$planId": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "seasonPrograms": {
      ".read": "auth != null",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".indexOn": ["seasonId","programId","enabled"],
      "$spId": {
        ".read": "auth != null",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".validate": "newData.hasChildren(['seasonId','programId'])",
        "seasonId": { ".validate": "newData.isString() && newData.val().length > 0" },
        "programId": { ".validate": "newData.isString() && newData.val().length > 0" },
        "enabled": { ".validate": "newData.isBoolean()" },
        "basePrice": { ".validate": "newData.val() == null || newData.isNumber()" },
        "maxParticipants": { ".validate": "newData.val() == null || newData.isNumber()" },
        "registrationOpen": { ".validate": "newData.val() == null || newData.isString()" },
        "registrationClose": { ".validate": "newData.val() == null || newData.isString()" },
        "questions": { ".validate": "newData.val() == null || newData.hasChildren()" },
        "createdAt": { ".validate": "newData.isString()" },
        "updatedAt": { ".validate": "newData.isString()" }
      }
    },
    "team_budgets": {
      ".read": "auth != null",
			".write": "auth != null && (auth.token.email == data.child('createdBy').val() || auth.token.email == 'westga.youthsports@gmail.com')",
      "$budgetId": {
        ".read": "auth != null",
				".write": "auth != null && (auth.token.email == data.child('createdBy').val() || auth.token.email == 'westga.youthsports@gmail.com')"
      }
    },
    "teamChats": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$teamId": {
        ".read": "auth != null && (root.child('teams').child($teamId).child('userId').val() == auth.uid || root.child('teams').child($teamId).child('coachId').val() == auth.uid || root.child('teams').child($teamId).child('members').child(auth.uid).exists() || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": false,
        "messages": {
          ".indexOn": ["timestamp","userId"],
          ".read": "auth != null && (root.child('teams').child($teamId).child('userId').val() == auth.uid || root.child('teams').child($teamId).child('coachId').val() == auth.uid || root.child('teams').child($teamId).child('members').child(auth.uid).exists() || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
          ".write": "auth != null && (root.child('teams').child($teamId).child('userId').val() == auth.uid || root.child('teams').child($teamId).child('coachId').val() == auth.uid || root.child('teams').child($teamId).child('members').child(auth.uid).exists() || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
          "$messageId": {
            ".read": "auth != null",
            ".write": "auth != null && root.child('teamChats').child($teamId).child('messages').child($messageId).child('userId').val() == auth.uid"
          }
        }
      }
    }
    ,
    "seasonTeamChats": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$seasonId": {
        "$teamId": {
          ".read": "auth != null && (root.child('teams').child($teamId).child('userId').val() == auth.uid || root.child('teams').child($teamId).child('coachId').val() == auth.uid || root.child('teams').child($teamId).child('members').child(auth.uid).exists() || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
          ".write": false,
          "messages": {
            ".indexOn": ["timestamp","userId"],
            ".read": "auth != null && (root.child('teams').child($teamId).child('userId').val() == auth.uid || root.child('teams').child($teamId).child('coachId').val() == auth.uid || root.child('teams').child($teamId).child('members').child(auth.uid).exists() || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
            ".write": "auth != null && (root.child('teams').child($teamId).child('userId').val() == auth.uid || root.child('teams').child($teamId).child('coachId').val() == auth.uid || root.child('teams').child($teamId).child('members').child(auth.uid).exists() || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
            "$messageId": {
              ".read": "auth != null",
              ".write": "auth != null && root.child('seasonTeamChats').child($seasonId).child($teamId).child('messages').child($messageId).child('userId').val() == auth.uid"
            }
          }
        }
      }
    },
    "programRegistrations": {
      ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".write": "auth != null",
      ".indexOn": ["familyId", "programId", "registeredBy"],
      "$registrationId": {
        ".read": "auth != null && (data.child('registeredBy').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": "auth != null && (data.child('registeredBy').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "carts": {
      "$userId": {
        ".read": "auth != null && (auth.uid == $userId || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": "auth != null && (auth.uid == $userId || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "auditLogs": {
      ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".write": "auth != null && ( !data.exists() || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".indexOn": ["timestamp"],
      "$logId": {
        ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": "auth != null && ( !data.exists() || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "teamAssignments": {
      ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      "$assignmentId": {
        ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    },
    "mailQueue": {
      ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".write": "auth != null",
      "$messageId": {
        ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": "auth != null"
      }
    },
    "paymentMethods": {
      ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
      ".write": "auth != null",
      ".indexOn": ["userId"],
      "$methodId": {
        ".read": "auth != null && (data.child('userId').val() == auth.uid || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')",
        ".write": "auth != null && (data.child('userId').val() == auth.uid || !data.exists() || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'owner')"
      }
    }
  }
}