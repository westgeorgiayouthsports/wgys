import{j as e,s as te,r as se}from"./index-lWfxYzVq.js";import{u as ae,r as f,L as _}from"./vendor-router-Ck4ZuSP9.js";import{u as ne,a as A}from"./vendor-redux-BbD-gcRX.js";import{S as h,x as ie,V as re,W as y,X as r,Y as oe,b as le,Z as ce,_ as de,g as ge,H as w,$,a0 as E,a1 as pe,T as me,a2 as V,a3 as z,B as R,a4 as fe,r as ue,a5 as xe,a6 as he,a7 as ye,a8 as C,M as je,a9 as ve}from"./vendor-antd-CieyQibU.js";import{t as Se}from"./firebaseTeams-DYGNnM-E.js";import{f as be}from"./analyticsClient-cghBTDXY.js";import{p as we}from"./firebasePrograms-DQfL_YhU.js";import{S as H}from"./season-CjhZh6iC.js";import{a as Re}from"./firebaseAnnouncements-nWIjlOxu.js";import{p as G}from"./firebaseProgramRegistrations-CcV5GOOA.js";import"./vendor-react-Ck9bq5u-.js";import"./vendor-firebase-BzUsRx-X.js";import"./slugify-IzZIKjBC.js";const{Title:Ce,Text:u,Link:ke}=ie;function Le(){const N=ne(),S=ae(),j=A(t=>t.teams.teams),K=A(t=>t.auth.user),g=A(t=>t.theme.isDarkMode),[i,W]=f.useState({websiteViews:0,totalRegistrants:0,moneyCollected:0,totalTeams:0,activeTeams:0,totalBudget:0,totalSpent:0,budgetUtilization:0,activePrograms:0}),[D,X]=f.useState([]),[O,Y]=f.useState([]),[L,k]=f.useState([]),[Z,U]=f.useState(!0),P=A(t=>t.ui?.websiteViewsRange||30),q=A(t=>t.ui?.customRange||null);f.useEffect(()=>{(async()=>{try{U(!0);const[a,n,p]=await Promise.all([Se.getTeams(),we.getPrograms(),Re.getAnnouncements()]);N(te(a)),X(n),Y(p.slice(0,5));try{const c=await se.getAllRegistrations();if(c&&c.length)k(c.slice(0,5));else try{const l=(await G.getAllProgramRegistrations()).map(s=>({id:s.id,teamId:s.programId||"",playerName:s.playerName||s.programName||"Registrant",playerAge:0,playerPosition:void 0,parentName:"",parentEmail:"",phoneNumber:"",fee:s.totalAmount||0,paymentMethod:s.paymentMethod||"other",status:s.status||"pending",rosterPlayerId:void 0,createdAt:s.createdAt||s.registrationDate||new Date().toISOString(),updatedAt:s.updatedAt}));k(l.slice(0,5))}catch(o){console.warn("Could not fetch program registrations:",o),k([])}}catch(c){console.warn("Could not fetch registrations (permission denied):",c);try{const l=(await G.getAllProgramRegistrations()).map(s=>({id:s.id,teamId:s.programId||"",playerName:s.playerName||s.programName||"Registrant",playerAge:0,playerPosition:void 0,parentName:"",parentEmail:"",phoneNumber:"",fee:s.totalAmount||0,paymentMethod:s.paymentMethod||"other",status:s.status||"pending",rosterPlayerId:void 0,createdAt:s.createdAt||s.registrationDate||new Date().toISOString(),updatedAt:s.updatedAt}));k(l.slice(0,5))}catch(o){console.warn("Could not fetch program registrations after fallback:",o),k([])}}}catch(a){console.error("Failed to load dashboard data:",a)}finally{U(!1)}})()},[N]),f.useEffect(()=>{const t=j.reduce((s,m)=>s+(m.budget||0),0),a=j.reduce((s,m)=>s+(m.spent||0),0),n=j.filter(s=>s.status===H.active).length,p=t>0?Math.round(a/t*100):0,c=D.filter(s=>s.active).length,o=D.reduce((s,m)=>s+(m.currentRegistrants||0),0),l=D.reduce((s,m)=>s+(m.totalPayments||0),0);W(s=>({...s,totalTeams:j.length,activeTeams:n,totalBudget:t,totalSpent:a,budgetUtilization:p,activePrograms:c,totalRegistrants:o,moneyCollected:l}))},[j,D]),f.useEffect(()=>{(async()=>{try{const{timeseries:a,views:n,realtimeViews:p}=await be(P),c=Array.isArray(a)?a.reduce((x,b)=>x+Number(b.views||0),0):0,o=typeof n=="number"?n:Number(n||0),l=typeof p=="number"?p:Number(p||0),s=o===0&&l>0?l:o,m=c||s||0;W(x=>({...x,websiteViews:m}))}catch(a){console.error("Website views fetch failed:",a)}})()},[P]);const T=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(t),I=({title:t,value:a,icon:n,trend:p,trendValue:c,format:o="number",onClick:l})=>{const s=o==="currency"?T(a):o==="percent"?`${a}%`:a.toLocaleString();return e.jsx(w,{className:"kpi-card",hoverable:!0,onClick:l,children:e.jsxs(h,{orientation:"vertical",style:{width:"100%"},size:16,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(u,{type:"secondary",style:{fontSize:"14px",fontWeight:500},children:t}),e.jsx("div",{style:{fontSize:"24px",color:"#1890ff"},children:n})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"28px",fontWeight:700,color:g?"#ffffff":"rgba(0, 0, 0, 0.85)"},children:s}),p&&c!==void 0&&e.jsxs(h,{size:4,style:{marginTop:"8px"},children:[p==="up"?e.jsx(xe,{style:{color:"#52c41a",fontSize:"12px"}}):e.jsx(he,{style:{color:"#ff4d4f",fontSize:"12px"}}),e.jsxs(u,{type:p==="up"?"success":"danger",style:{fontSize:"12px",fontWeight:500},children:[c,"% from last month"]})]})]})]})})},J=t=>{const{websiteViewsRange:a,customRange:n,onSelectPreset:p,onApplyCustom:c}=t,[o,l]=f.useState(!1),[s,m]=f.useState(!1),[x,b]=f.useState(null),ee=[1,7,30,90,180,365],B=!!(n&&n.from&&n.to),F=B&&n&&n.from&&n.to?`${new Date(n.from).toLocaleDateString()} → ${new Date(n.to).toLocaleDateString()}`:`${a}d`;return e.jsxs(e.Fragment,{children:[e.jsx(ye,{content:e.jsxs("div",{style:{padding:8,minWidth:260},children:[e.jsx("div",{style:{display:"flex",gap:8,marginBottom:8},children:ee.map(d=>{const M=!B&&a===d;return e.jsx(R,{size:"small",type:M?"primary":"default",onClick:()=>{p(d),l(!1)},children:d===365?"1y":d===180?"6m":`${d}d`},d)})}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx(R,{size:"small",type:B?"primary":"default",onClick:()=>{if(n&&n.from&&n.to)b([C(n.from),C(n.to)]);else if(a&&a>0){const d=Math.max(a-1,0);b([C().subtract(d,"day"),C()])}else b([C().subtract(29,"day"),C()]);m(!0),l(!1)},children:"Custom Range"}),e.jsx(u,{type:"secondary",style:{fontSize:12},children:"or pick a preset"})]})]}),title:"Select Date Range",trigger:"click",open:o,onOpenChange:d=>l(d),children:e.jsxs(R,{type:"link",onClick:()=>l(!0),style:{padding:"4px 8px"},className:"date-range-hotspot pulse","aria-haspopup":"dialog","aria-label":`Range ${F} — open date range selector`,children:[e.jsx("span",{style:{marginRight:6,opacity:.9},children:"Range:"}),e.jsx("span",{children:F})]})}),e.jsx(je,{title:"Select Custom Range",open:s,onCancel:()=>m(!1),onOk:()=>{if(x&&x[0]&&x[1]){const d=x[0].toISOString(),M=x[1].toISOString();c(d,M)}m(!1)},children:e.jsx(ve.RangePicker,{value:x,onChange:d=>b(d),allowClear:!0,style:{width:"100%"}})})]})},v=(t=>t<50?{color:"#52c41a",status:"Healthy"}:t<80?{color:"#faad14",status:"Caution"}:{color:"#ff4d4f",status:"Critical"})(i.budgetUtilization),Q=[{title:"Team Name",dataIndex:"name",key:"name",render:t=>e.jsx(u,{strong:!0,children:t})},{title:"Status",dataIndex:"status",key:"status",render:t=>e.jsx(E,{color:t===H.active?"green":"default",children:t?.toUpperCase()||"UNKNOWN"})},{title:"Budget",dataIndex:"budget",key:"budget",render:t=>e.jsx(u,{children:T(t||0)}),align:"right"},{title:"Spent",dataIndex:"spent",key:"spent",render:t=>e.jsx(u,{type:"danger",children:T(t||0)}),align:"right"},{title:"Remaining",key:"remaining",render:(t,a)=>{const n=(a.budget||0)-(a.spent||0);return e.jsx(u,{type:n>=0?"success":"danger",children:T(n)})},align:"right"}];return e.jsxs("div",{className:"dashboard-page",style:{backgroundColor:g?"#141414":"#fafafa",color:g?"#ffffff":"rgba(0, 0, 0, 0.85)"},children:[e.jsxs(h,{className:"dashboard-header",orientation:"vertical",size:8,children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:e.jsxs("div",{children:[e.jsx(Ce,{level:2,style:{margin:0},children:"Dashboard"}),e.jsxs(u,{type:"secondary",children:["Welcome back, ",K?.displayName||"Admin","! Here's your organization overview."]})]})}),e.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"flex-end"},children:e.jsx(J,{websiteViewsRange:P,customRange:q,onApplyCustom:(t,a)=>N({type:"ui/setWebsiteCustomRange",payload:{from:t,to:a}}),onSelectPreset:t=>N({type:"ui/setWebsiteViewsRange",payload:t})})})]}),e.jsxs(re,{spinning:Z,children:[e.jsxs(y,{gutter:[24,24],style:{marginBottom:"32px"},children:[e.jsx(r,{xs:24,sm:12,lg:6,children:e.jsx(I,{title:`Website Page Views (${P}d)`,value:i.websiteViews,icon:e.jsx(oe,{}),onClick:()=>S("/admin/analytics")})}),e.jsx(r,{xs:24,sm:12,lg:6,children:e.jsx(I,{title:"Total Registrants",value:i.totalRegistrants,icon:e.jsx(le,{}),onClick:()=>S("/admin/registrations")})}),e.jsx(r,{xs:24,sm:12,lg:6,children:e.jsx(I,{title:"Money Collected",value:i.moneyCollected,icon:e.jsx(ce,{}),format:"currency",onClick:()=>S("/admin/payments")})}),e.jsx(r,{xs:24,sm:12,lg:6,children:e.jsx(I,{title:"Active Programs",value:i.activePrograms,icon:e.jsx(de,{}),onClick:()=>S("/admin/programs")})})]}),e.jsx(y,{gutter:[24,24],style:{marginBottom:"32px"},children:e.jsx(r,{xs:24,sm:12,lg:6,children:e.jsx(I,{title:"Active Teams",value:i.activeTeams,icon:e.jsx(ge,{}),onClick:()=>S("/admin/teams")})})}),e.jsxs(y,{gutter:[24,24],children:[e.jsx(r,{xs:24,lg:12,children:e.jsx(w,{title:"Budget Overview",hoverable:!0,style:{backgroundColor:g?"#1f1f1f":"#ffffff"},children:e.jsxs(h,{orientation:"vertical",style:{width:"100%"},size:24,children:[e.jsxs(y,{gutter:[16,16],children:[e.jsx(r,{xs:12,children:e.jsx($,{title:"Total Budget",value:i.totalBudget,prefix:"$",precision:0,styles:{content:{color:g?"#ffffff":"#1890ff"}}})}),e.jsx(r,{xs:12,children:e.jsx($,{title:"Total Spent",value:i.totalSpent,prefix:"$",precision:0,styles:{content:{color:g?"#ffffff":"#ff4d4f"}}})})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:g?"#262626":"#f5f5f5",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(h,{orientation:"vertical",size:0,children:[e.jsx(u,{type:"secondary",style:{fontSize:"12px"},children:"Budget Utilization"}),e.jsxs("div",{style:{fontSize:"24px",fontWeight:700,color:v.color},children:[i.budgetUtilization,"%"]}),e.jsx(E,{style:{marginTop:"8px",backgroundColor:g?`${v.color}20`:void 0,color:v.color,borderColor:v.color},children:v.status})]}),e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",backgroundColor:`${v.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"28px"},children:e.jsx(pe,{style:{color:v.color}})})]})]})})}),e.jsx(r,{xs:24,lg:12,children:e.jsx(w,{title:"Organization Stats",hoverable:!0,style:{backgroundColor:g?"#1f1f1f":"#ffffff"},children:e.jsxs(h,{orientation:"vertical",style:{width:"100%"},size:16,children:[e.jsxs(y,{children:[e.jsxs(r,{span:12,children:[e.jsx(u,{type:"secondary",children:"Total Teams"}),e.jsx("div",{style:{fontSize:"24px",fontWeight:700,marginTop:"4px",color:g?"#ffffff":"rgba(0, 0, 0, 0.85)"},children:i.totalTeams})]}),e.jsxs(r,{span:12,style:{textAlign:"right"},children:[e.jsx(me,{title:"Teams with active status",children:e.jsx(u,{type:"secondary",children:"Active Teams"})}),e.jsx("div",{style:{fontSize:"24px",fontWeight:700,marginTop:"4px",color:i.activeTeams>0?"#52c41a":"#d9d9d9"},children:i.activeTeams})]})]}),e.jsx("div",{style:{height:"1px",backgroundColor:g?"#434343":"#f0f0f0"}}),e.jsxs(y,{children:[e.jsx(r,{span:12,children:e.jsx($,{title:"Avg Budget/Team",value:i.totalTeams>0?i.totalBudget/i.totalTeams:0,prefix:"$",precision:0})}),e.jsx(r,{span:12,style:{textAlign:"right"},children:e.jsx($,{title:"Remaining Budget",value:i.totalBudget-i.totalSpent,prefix:"$",precision:0})})]})]})})})]}),e.jsxs(y,{gutter:[24,24],style:{marginTop:"24px"},children:[e.jsx(r,{xs:24,lg:12,children:e.jsx(w,{title:e.jsxs(h,{children:[e.jsx(fe,{style:{fontSize:"20px"}}),e.jsx("span",{children:"Recent Announcements"})]}),extra:e.jsx(_,{to:"/admin/announcements",children:e.jsx(R,{type:"link",size:"small",children:"See All"})}),hoverable:!0,style:{backgroundColor:g?"#1f1f1f":"#ffffff"},children:O.length>0?e.jsx(V,{columns:[{title:"Title",dataIndex:"title",key:"title",render:(t,a)=>e.jsx(ke,{href:`#/announcements/${a.id}`,ellipsis:!0,children:t})},{title:"Status",dataIndex:"status",key:"status",render:t=>e.jsx(E,{color:t==="published"?"green":"orange",children:t.toUpperCase()}),width:100},{title:"Views",dataIndex:"views",key:"views",align:"center",width:80}],dataSource:O.map(t=>({...t,key:t.id})),pagination:!1,size:"small"}):e.jsx(z,{description:"No announcements yet",image:z.PRESENTED_IMAGE_SIMPLE})})}),e.jsx(r,{xs:24,lg:12,children:e.jsx(w,{title:e.jsxs(h,{children:[e.jsx(ue,{style:{fontSize:"20px"}}),e.jsx("span",{children:"Recent Registrations"})]}),extra:e.jsx(_,{to:"/admin/registrations",children:e.jsx(R,{type:"link",size:"small",children:"See All"})}),hoverable:!0,style:{backgroundColor:g?"#1f1f1f":"#ffffff"},children:L.length>0?e.jsx(V,{columns:[{title:"Player",dataIndex:"playerName",key:"playerName"},{title:"Status",dataIndex:"status",key:"status",render:t=>e.jsx(E,{color:t==="paid"?"green":t==="approved"?"blue":"orange",children:t.toUpperCase()}),width:90},{title:"Fee",dataIndex:"fee",key:"fee",render:t=>T(t),align:"right",width:100}],dataSource:L.map((t,a)=>({...t,key:t.id||a})),pagination:!1,size:"small"}):e.jsx(z,{description:"No registrations yet",image:z.PRESENTED_IMAGE_SIMPLE})})})]}),e.jsx(y,{gutter:[24,24],style:{marginTop:"24px"},children:e.jsx(r,{span:24,children:e.jsx(w,{title:"Teams Breakdown",extra:e.jsx(R,{type:"primary",onClick:()=>S("/admin/teams"),children:"Manage Teams"}),hoverable:!0,children:j.length>0?e.jsx(V,{columns:Q,dataSource:j.map(t=>({...t,key:t.id})),pagination:{pageSize:10},size:"middle"}):e.jsx(z,{description:"No teams yet",style:{marginTop:"24px"}})})})})]})]})}export{Le as default};
