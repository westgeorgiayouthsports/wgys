import{j as e}from"./index-lWfxYzVq.js";import{R as I,r as i}from"./vendor-router-Ck4ZuSP9.js";import{A as R}from"./AdminPageHeader-BidreVSQ.js";import{p as y}from"./paymentPlans-v28zbRiz.js";import{s as D}from"./firebaseSeasons-BgcPTcUq.js";import{p as M}from"./firebasePrograms-DQfL_YhU.js";import{G as n,I as P,ak as T,ad as g,d as S,S as b,B as p,aF as w,ab as N,x as H,H as $,V as B,a2 as L,M as V,a0 as v,af as q,ag as z,ah as G}from"./vendor-antd-CieyQibU.js";import"./vendor-react-Ck9bq5u-.js";import"./vendor-redux-BbD-gcRX.js";import"./vendor-firebase-BzUsRx-X.js";import"./season-CjhZh6iC.js";import"./firebaseTeams-DYGNnM-E.js";import"./slugify-IzZIKjBC.js";function K({initialValues:s,onCancel:h,onSave:x}){const[c]=n.useForm(),[f,m]=I.useState([]),[r,u]=I.useState([]);i.useEffect(()=>{(async()=>{try{const[l,d]=await Promise.all([D.getSeasons(),M.getPrograms()]);m(l),u(d)}catch(l){console.error("Failed loading seasons/programs",l)}})()},[]),i.useEffect(()=>{c.setFieldsValue({...s||{}})},[s]);const j=async()=>{const t=await c.validateFields();await x(t)};return e.jsxs(n,{layout:"vertical",form:c,initialValues:s||{active:!0},children:[e.jsx(n.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:e.jsx(P,{})}),e.jsx(n.Item,{name:"active",label:"Active",valuePropName:"checked",children:e.jsx(T,{})}),e.jsx(n.Item,{name:"initialAmount",label:"Initial Amount (USD)",children:e.jsx(g,{min:0,precision:2,style:{width:"100%"}})}),e.jsx(n.Item,{name:"installments",label:"Installments",children:e.jsx(g,{min:0,style:{width:"100%"}})}),e.jsx(n.Item,{name:"paymentDay",label:"Payment Day (1-28)",children:e.jsx(g,{min:1,max:28,style:{width:"100%"}})}),e.jsx(n.Item,{name:"stripePriceId",label:"Stripe Price ID",children:e.jsx(P,{})}),e.jsx(n.Item,{name:"stripeProductId",label:"Stripe Product ID",children:e.jsx(P,{})}),e.jsx(n.Item,{name:"seasonId",label:"Season (optional)",children:e.jsx(S,{allowClear:!0,showSearch:!0,options:f.map(t=>({label:t.name,value:t.id}))})}),e.jsx(n.Item,{name:"programIds",label:"Programs (optional)",children:e.jsx(S,{mode:"multiple",allowClear:!0,showSearch:!0,options:r.map(t=>({label:t.name,value:t.id}))})}),e.jsx(n.Item,{children:e.jsxs(b,{children:[e.jsx(p,{onClick:h,children:"Cancel"}),e.jsx(p,{type:"primary",onClick:j,children:"Save"})]})})]})}const{Title:U}=H;function ie(){const[s,h]=w.useNotification(),[x,c]=i.useState([]),[f,m]=i.useState(!0),[r,u]=i.useState(null),[j,t]=i.useState(!1),l=i.useRef(!1),d=async()=>{try{m(!0);const a=await y.getPaymentPlans();c(a||[])}catch(a){if(console.error(a),l.current){m(!1);return}(a&&a.message||String(a)).toLowerCase().includes("permission")?(l.current=!0,s.error({title:"Permission denied reading payment plans",description:"Your account does not have permission to read payment plans from the database. Ensure your RTDB rules allow admin reads or run this page from an account with admin access.",duration:8})):(l.current=!0,s.error({title:"Failed to load payment plans"}))}finally{m(!1)}};i.useEffect(()=>{d()},[]);const C=()=>{u(null),t(!0)},k=a=>{u(a),t(!0)},F=async a=>{try{r&&r.id?(await y.updatePaymentPlan(r.id,a),s.success({title:"Payment plan updated"})):(await y.createPaymentPlan(a),s.success({title:"Payment plan created"})),t(!1),await d()}catch(o){console.error(o),w.error({message:"Failed to save payment plan"})}},A=async a=>{if(a)try{await y.deletePaymentPlan(a),s.success({title:"Payment plan deleted"}),await d()}catch(o){console.error(o),s.error({title:"Failed to delete payment plan"})}},E=[{title:"Name",dataIndex:"name",key:"name"},{title:"Active",dataIndex:"active",key:"active",render:a=>a?e.jsx(v,{color:"green",children:"Active"}):e.jsx(v,{children:"Inactive"})},{title:"Initial",dataIndex:"initialAmount",key:"initial",render:a=>a!=null?`$${a.toFixed(2)}`:"-"},{title:"Installments",dataIndex:"installments",key:"installments"},{title:"Stripe Price",dataIndex:"stripePriceId",key:"stripePriceId"},{title:"Actions",key:"actions",render:(a,o)=>e.jsxs(b,{children:[e.jsx(p,{icon:e.jsx(q,{}),onClick:()=>k(o)}),e.jsx(z,{title:"Delete this plan?",onConfirm:()=>A(o.id),children:e.jsx(p,{danger:!0,icon:e.jsx(G,{})})})]})}];return e.jsxs("div",{style:{padding:24,minHeight:"100vh"},children:[h,e.jsx(R,{title:e.jsx(U,{level:3,style:{margin:0},children:"Payment Plans"}),subtitle:"Manage global payment plans used by the cart and checkout flows.",actions:e.jsx(p,{type:"primary",icon:e.jsx(N,{}),onClick:C,children:"Create Payment Plan"})}),e.jsx($,{children:e.jsx(B,{spinning:f,children:e.jsx(L,{dataSource:x.map(a=>({...a,key:a.id})),columns:E,pagination:{pageSize:20},rowKey:"id"})})}),e.jsx(V,{open:j,onCancel:()=>t(!1),footer:null,title:r?"Edit Payment Plan":"Create Payment Plan",children:e.jsx(K,{initialValues:r||null,onCancel:()=>t(!1),onSave:F})})]})}export{ie as default};
