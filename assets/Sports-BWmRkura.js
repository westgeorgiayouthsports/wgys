import{j as t,l}from"./index-lWfxYzVq.js";import{r as i}from"./vendor-router-Ck4ZuSP9.js";import{A as R}from"./AdminPageHeader-BidreVSQ.js";import{s as p}from"./firebaseSports-DK6SYh6x.js";import{s as I}from"./slugify-IzZIKjBC.js";import{G as f,B as S,ab as T,H as $,a2 as B,M as O,I as C,Q as o,S as q,af as z,ag as H,ah as P}from"./vendor-antd-CieyQibU.js";import"./vendor-react-Ck9bq5u-.js";import"./vendor-redux-BbD-gcRX.js";import"./vendor-firebase-BzUsRx-X.js";function te(){const[x,M]=i.useState([]),[b,j]=i.useState(!1),[A,g]=i.useState(!1),[a,D]=i.useState(null),[s]=f.useForm(),c=i.useRef(void 0),y=async()=>{j(!0);try{const r=(await p.getSports()||[]).slice().sort((n,d)=>String(n?.name||"").localeCompare(String(d?.name||"")));M(r)}catch(e){l.error("Failed loading sports",e),o.error("Failed to load sports")}finally{j(!1)}};i.useEffect(()=>{y()},[]);const k=()=>{D(null),s.resetFields(),g(!0)},v=e=>{l.info("Editing sport:",e),D(e),s.setFieldsValue({id:e?.id??"",name:e?.name??e?.Name??"",ageControlDate:e?.ageControlDate??e?.age_control_date??e?.age??""}),g(!0)};i.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]);const w=e=>{c.current&&clearTimeout(c.current),c.current=window.setTimeout(async()=>{try{const r=String(e||s.getFieldValue("name")||"").trim();if(!r){s.setFields([{name:"name",errors:[]}]);return}(await p.getSports()).find(m=>(m.name||"").trim().toLowerCase()===r.toLowerCase()&&(!(a&&a.id)||m.id!==a.id))?s.setFields([{name:"name",errors:["A sport with that name already exists"]}]):s.setFields([{name:"name",errors:[]}])}catch(r){l.error("Name duplicate check failed",r)}},300)},E=async e=>{try{await p.deleteSport(e),o.success("Sport deleted"),y()}catch(r){l.error("Delete failed",r),o.error("Failed to delete sport")}},N=async()=>{try{const e=await s.validateFields(),r=String(e.ageControlDate||"").trim(),n=r.match(/^(\d{2})-(\d{2})$/);if(!n){o.error("Age Control must be in MM-DD format");return}const d=Number(n[1]),m=Number(n[2]),L=[31,29,31,30,31,30,31,31,30,31,30,31];if(d<1||d>12||m<1||m>L[d-1]){o.error("Age Control date is not a valid month/day");return}const h=String(e.name||"").trim(),F=String(e.id||I(h));if(x.find(u=>(u.name||"").toLowerCase()===h.toLowerCase()&&(!(a&&a.id)||u.id!==a.id))){o.error("A sport with that name already exists");return}if(x.find(u=>u.id===F&&(!(a&&a.id)||u.id!==a.id))){o.error("A sport with that id already exists");return}a&&a.id?(await p.updateSport(a.id,{...e,name:h,ageControlDate:r}),o.success("Sport updated")):(await p.createSport({...e,id:F,name:h,ageControlDate:r}),o.success("Sport created")),g(!1),y()}catch(e){l.error("Save failed",e),o.error("Failed to save sport")}},V=[{title:"Name",dataIndex:"name",key:"name"},{title:"ID",dataIndex:"id",key:"id",render:e=>t.jsx("span",{style:{fontFamily:"monospace"},children:e})},{title:"Age Control",dataIndex:"ageControlDate",key:"ageControlDate"},{title:"Actions",key:"actions",render:e=>t.jsxs(q,{children:[t.jsx(S,{size:"small",icon:t.jsx(z,{}),onClick:()=>v(e),children:"Edit"}),t.jsx(H,{title:"Delete sport?",onConfirm:()=>E(e.id),children:t.jsx(S,{size:"small",danger:!0,icon:t.jsx(P,{}),children:"Delete"})})]})}];return t.jsxs("div",{className:"page-container full-width",children:[t.jsx(R,{title:t.jsx("h2",{style:{margin:0},children:"Sports"}),subtitle:"Manage sports and their age control dates",actions:t.jsx(S,{type:"primary",icon:t.jsx(T,{}),onClick:k,children:"Add Sport"})}),t.jsx($,{children:t.jsx(B,{dataSource:x,columns:V,rowKey:"id",loading:b})}),t.jsx(O,{title:a?"Edit Sport":"Add Sport",open:A,onOk:N,onCancel:()=>g(!1),children:t.jsxs(f,{form:s,layout:"vertical",onValuesChange:(e,r)=>{if(e.name!==void 0){try{s.setFieldsValue({id:I(String(r.name||""))})}catch(n){l.error("Failed computing id",n)}e.name!==void 0&&w(r.name)}},children:[t.jsx(f.Item,{name:"name",label:"Name",rules:[{required:!0}],children:t.jsx(C,{onBlur:()=>w(),onChange:()=>{}})}),t.jsx(f.Item,{name:"id",label:"ID (computed)",children:t.jsx(C,{readOnly:!0,style:{fontFamily:"monospace"}})}),t.jsx(f.Item,{name:"ageControlDate",label:"Age Control (MM-DD)",rules:[{required:!0,pattern:/^\d{2}-\d{2}$/}],children:t.jsx(C,{placeholder:"MM-DD"})})]})})]})}export{te as default};
