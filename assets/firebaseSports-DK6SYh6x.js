import{n as p,o,z as u,x as h,q as S}from"./vendor-firebase-BzUsRx-X.js";import{e as n,q as l,A as g,l as i}from"./index-lWfxYzVq.js";import{s as f}from"./slugify-IzZIKjBC.js";const C={async getSports(){try{const t=await p(o(n,"sports"));if(!t.exists())return[];const r=t.val();return Object.entries(r).map(([e,a])=>({id:e,...a}))}catch(t){return i.error("Error fetching sports",t),[]}},async getById(t){try{const r=await p(o(n,`sports/${t}`));return r.exists()?{id:t,...r.val()}:null}catch(r){return i.error("Error fetching sport",r),null}},async createSport(t,r){try{const e=new Date().toISOString(),a={name:t.name,ageControlDate:t.ageControlDate,createdAt:e,updatedAt:e,createdBy:r||null};try{const s=await p(o(n,"sports"));if(s.exists()){const d=s.val();if(Object.entries(d).find(([,m])=>String(m.name||"").trim().toLowerCase()===String(t.name||"").trim().toLowerCase()))throw new Error("A sport with that name already exists")}}catch(s){if(s.message==="A sport with that name already exists")throw s;i.error("Error checking duplicate sport names",s)}let c=t.id?String(t.id):f(String(t.name||""));if((await p(o(n,`sports/${c}`))).exists())throw new Error("Sport id already exists");await S(o(n,`sports/${c}`),a);try{await l.log({action:"sport.created",entityType:g.Sport,entityId:c,details:a})}catch(s){i.error("Error auditing sport.created",s)}return c}catch(e){throw i.error("Error creating sport",e),e}},async updateSport(t,r){try{if(r.name){const a=await p(o(n,"sports"));if(a.exists()){const c=a.val();if(Object.entries(c).find(([d,w])=>d!==t&&String(w.name||"").trim().toLowerCase()===String(r.name||"").trim().toLowerCase()))throw new Error("A sport with that name already exists")}}const e={...r,updatedAt:new Date().toISOString()};await h(o(n,`sports/${t}`),e);try{await l.log({action:"sport.updated",entityType:g.Sport,entityId:t,details:e})}catch(a){i.error("Error auditing sport.updated",a)}}catch(e){throw i.error("Error updating sport",e),e}},async deleteSport(t){try{const r=await p(o(n,`sports/${t}`)),e=r.exists()?r.val():null;await u(o(n,`sports/${t}`));try{await l.log({action:"sport.deleted",entityType:g.Sport,entityId:t,details:e})}catch(a){i.error("Error auditing sport.deleted",a)}}catch(r){throw i.error("Error deleting sport",r),r}}};export{C as s};
