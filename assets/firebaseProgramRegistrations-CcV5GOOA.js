import{o as g,n as l,q as w,A as h,B as f,N as R,t as I}from"./vendor-firebase-BzUsRx-X.js";import{e as c,q as E,A as P,l as s}from"./index-lWfxYzVq.js";const x={async createProgramRegistration(a,r,t,e,i,o,n,v,d){try{const m=g(c,"programRegistrations"),u=I(m),p={programId:a,programName:d?.programName,athleteId:o||void 0,playerName:d?.playerName,familyId:n||void 0,registeredBy:r,responses:t,status:"pending",paymentMethod:i,paymentDisplay:d?.paymentDisplay,paymentPlan:v||"full",totalAmount:e,registrationDate:new Date().toISOString(),createdAt:new Date().toISOString()};Object.keys(p).forEach(y=>{p[y]===void 0&&delete p[y]}),await w(u,p);try{await E.log({action:"program.registration.created",entityType:P.Program,entityId:u.key??null,details:{programId:a,registeredBy:r,totalAmount:e,paymentMethod:i}})}catch(y){s.error("Error auditing program.registration.created:",y)}return{id:u.key,...p}}catch(m){throw s.error("❌ Error creating program registration:",m),m}},async getProgramRegistration(a){try{const r=g(c,`programRegistrations/${a}`),t=await l(r);return t.exists()?{id:a,...t.val()}:null}catch(r){throw s.error("❌ Error fetching program registration:",r),r}},async getProgramRegistrationsByFamily(a){try{const r=g(c,"programRegistrations"),t=h(r,f("familyId"),R(a)),e=await l(t);if(!e.exists())return[];const i=e.val();return Object.entries(i).map(([o,n])=>({id:o,...n}))}catch(r){throw s.error("❌ Error querying registrations by family:",r),r}},async getProgramRegistrationsByAthlete(a){try{const r=g(c,"programRegistrations"),t=h(r,f("athleteId"),R(a)),e=await l(t);if(!e.exists())return[];const i=e.val();return Object.entries(i).map(([o,n])=>({id:o,...n}))}catch(r){throw s.error("❌ Error querying registrations by athlete:",r),r}},async getProgramRegistrationsByProgram(a){try{const r=g(c,"programRegistrations"),t=h(r,f("programId"),R(a)),e=await l(t);if(!e.exists())return[];const i=e.val();return Object.entries(i).map(([o,n])=>({id:o,...n}))}catch(r){throw s.error("❌ Error querying registrations by program:",r),r}},async getAllProgramRegistrations(){try{const a=g(c,"programRegistrations"),r=await l(a);if(!r.exists())return[];const t=r.val();return Object.entries(t).map(([i,o])=>({id:i,...o})).sort((i,o)=>new Date(o.createdAt).getTime()-new Date(i.createdAt).getTime())}catch(a){throw s.error("❌ Error fetching all program registrations:",a),a}},async updateProgramRegistration(a,r){try{const t=g(c,`programRegistrations/${a}`),e=await l(t);if(!e.exists())throw new Error("Registration not found");const o={...e.val(),...r,updatedAt:new Date().toISOString()};await w(t,o);try{await E.log({action:"program.registration.updated",entityType:P.Program,entityId:a,details:r})}catch(n){s.error("Error auditing program.registration.updated:",n)}}catch(t){throw s.error("❌ Error updating program registration:",t),t}},async cancelProgramRegistration(a,r){try{const t=g(c,`programRegistrations/${a}`),e=await l(t);if(!e.exists())throw new Error("Registration not found");const o={...e.val(),status:"cancelled",cancelledAt:new Date().toISOString(),cancelledReason:r||null,updatedAt:new Date().toISOString()};await w(t,o);try{await E.log({action:"program.registration.cancelled",entityType:P.Program,entityId:a,details:{reason:r}})}catch(n){s.error("Error auditing program.registration.cancelled:",n)}}catch(t){throw s.error("❌ Error cancelling program registration:",t),t}}};export{x as p};
