import{j as e,l as k,p as F,u as Z,e as _,v as ee,w as se,x as te}from"./index-lWfxYzVq.js";import{r as l}from"./vendor-router-Ck4ZuSP9.js";import{u as ie,a as m}from"./vendor-redux-BbD-gcRX.js";import{p as I}from"./firebasePeople-B5ZBKo1U.js";import{x as q,S as L,T as ae,B as b,at as re,H as Q,W as oe,X as O,ai as H,b as A,I as V,i as le,ak as T,M as ne,af as de,C as ce,ae as pe,Q as D,F as ue,V as he}from"./vendor-antd-CieyQibU.js";import{w as ge,o as ye,x as xe}from"./vendor-firebase-BzUsRx-X.js";import"./vendor-react-Ck9bq5u-.js";const{Text:U}=q;function W({label:s,value:a,help:h,monospace:n}){const r=async()=>{if(a)try{await navigator.clipboard.writeText(a)}catch(u){k.error("Failed to copy to clipboard",u)}};return e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(U,{strong:!0,style:{display:"block",marginBottom:6},children:s}),e.jsxs(L,{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{display:"flex",gap:12,alignItems:"center",width:"100%"},children:e.jsx(U,{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block"},children:e.jsx("span",{style:n?{fontFamily:"monospace",fontSize:13}:void 0,children:a||"-"})})}),a&&e.jsx(ae,{title:"Copy",children:e.jsx(b,{size:"small",icon:e.jsx(re,{}),onClick:r})})]}),h&&e.jsx(U,{type:"secondary",style:{display:"block",marginTop:6},children:h})]})}const{Title:me,Text:i}=q;function fe({person:s,onPersonUpdate:a,showThemeToggle:h=!0}){const n=ie(),r=m(t=>t.auth.user),{role:u}=m(t=>t.auth),y=m(t=>t.theme.isDarkMode),c=m(t=>t.ui.showMyMenuItems),f=m(t=>t.ui.debugLogging),[o,x]=l.useState(!1),[S,X]=l.useState(!1),[g,B]=l.useState(s.displayName||`${s.firstName} ${s.lastName}`),[d,E]=l.useState(s.photoURL||""),[G,C]=l.useState(!1),[N,P]=l.useState(!1),[j,M]=l.useState(y),[w,z]=l.useState(c),[v,$]=l.useState(f),p=s.userId===r?.uid||u==="admin"||u==="owner",J=async()=>{P(!0);try{if(d&&d.length>2e3){D.error("Photo URL is too long. Please use a shorter URL."),P(!1);return}const t={displayName:g,photoURL:d||void 0};if(await I.updatePersonProfile(s.id,t),s.userId===r?.uid&&F.currentUser&&r&&(await ge(F.currentUser,{displayName:g,photoURL:d||null}),n(Z({user:{...r,displayName:g,photoURL:d},role:u,createdAt:r.createdAt}))),a({...s,displayName:g,photoURL:d,updatedAt:new Date().toISOString()}),s.userId===r?.uid&&r?.uid)try{const R=ye(_,`users/${r.uid}/preferences`);await xe(R,{theme:j?"dark":"light",showMyMenuItems:w,debugLogging:v}),n(ee(j)),n(se(w)),n(te(v));try{localStorage.setItem("wgys.pref.theme",j?"dark":"light"),localStorage.setItem("wgys.pref.showMyMenuItems",String(w)),localStorage.setItem("wgys.debugLogging",v?"1":"0")}catch(Y){k.error("Failed to cache preferences locally",Y)}}catch(R){k.error("Failed to persist preferences to RTDB",R)}D.success("Profile updated successfully!"),x(!1)}catch(t){k.error("Error updating profile:",t),D.error("Failed to update profile")}finally{P(!1)}},K=()=>{B(s.displayName||`${s.firstName} ${s.lastName}`),E(s.photoURL||""),M(y),z(c),$(f),x(!1)};return l.useEffect(()=>{M(y)},[y]),e.jsx(e.Fragment,{children:e.jsxs(Q,{title:"Profile Settings",extra:p&&!o?e.jsx(b,{type:"primary",icon:e.jsx(de,{}),onClick:()=>{x(!0)},children:"Edit Profile"}):p&&o?e.jsxs(L,{children:[e.jsx(b,{icon:e.jsx(ce,{}),onClick:K,disabled:N,children:"Cancel"}),e.jsx(b,{type:"primary",icon:e.jsx(pe,{}),onClick:J,loading:N,children:"Save Changes"})]}):null,children:[e.jsxs(oe,{gutter:[24,24],children:[e.jsxs(O,{span:24,md:6,style:{textAlign:"center"},children:[e.jsx(H,{size:96,src:d||s.photoURL,icon:e.jsx(A,{}),style:{backgroundColor:"#00d4ff",marginBottom:"16px",cursor:o&&p?"pointer":"default"},onClick:()=>o&&p&&C(!0),onError:()=>!0}),o&&p&&e.jsx(i,{type:"secondary",style:{fontSize:"12px",display:"block"},children:"Click to change profile image"}),e.jsxs("div",{children:[e.jsx(me,{level:4,style:{margin:"0 0 4px 0"},children:g||`${s.firstName} ${s.lastName}`}),e.jsx(i,{type:"secondary",children:s.hasAccount?"Account Holder":"Family Member"})]})]}),e.jsx(O,{span:24,md:18,children:e.jsxs(L,{orientation:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(i,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"Display Name"}),e.jsx(V,{value:g,onChange:t=>{B(t.target.value)},disabled:!o||!p,placeholder:"Enter display name",size:"middle",maxLength:50}),o&&e.jsxs(i,{type:"secondary",style:{fontSize:"12px",marginTop:"4px",display:"block"},children:[g.length,"/50 characters"]})]}),e.jsxs("div",{style:{padding:"12px 16px",border:"1px solid #d9d9d9",borderRadius:8},children:[e.jsx(i,{strong:!0,style:{display:"block",marginBottom:8},children:"System Assigned"}),e.jsx(i,{type:"secondary",style:{display:"block",marginBottom:12},children:"These values are managed by the system and are read-only."}),e.jsx(W,{label:"Email Address",value:s.email||"",help:"Managed by authentication system"}),s.userId&&e.jsx(W,{label:"User ID",value:s.userId,monospace:!0,help:"System-assigned unique identifier (read-only)"})]}),h&&s.userId===r?.uid&&e.jsxs("div",{children:[e.jsxs(i,{strong:!0,style:{display:"block",marginBottom:"8px"},children:[e.jsx(le,{})," Theme Preference"]}),e.jsxs("div",{style:{padding:"12px 16px",border:"1px solid #d9d9d9",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{children:j?"Dark Mode":"Light Mode"}),e.jsx(T,{checked:j,onChange:t=>M(t),disabled:!o||!p,checkedChildren:"ðŸŒ™",unCheckedChildren:"â˜€ï¸"})]}),e.jsx(i,{type:"secondary",style:{fontSize:"12px",marginTop:"4px",display:"block"},children:"Choose your preferred theme appearance"})]}),s.userId===r?.uid&&e.jsxs("div",{children:[e.jsx(i,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"Sidebar Preferences"}),e.jsxs("div",{style:{padding:"12px 16px",border:"1px solid #d9d9d9",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{children:'Show "My" items in left sidebar'}),e.jsx(T,{checked:w,onChange:t=>z(t),disabled:!o||!p,checkedChildren:"On",unCheckedChildren:"Off"})]}),e.jsx(i,{type:"secondary",style:{fontSize:"12px",marginTop:"4px",display:"block"},children:'When off, menu items starting with "My" will be available from your user menu only.'})]}),s.userId===r?.uid&&e.jsxs("div",{children:[e.jsx("div",{style:{marginTop:8,marginBottom:8},children:e.jsx(b,{type:"link",onClick:()=>X(t=>!t),style:{padding:0},children:S?"Hide diagnostics":"Show diagnostics"})}),S&&e.jsxs("div",{style:{padding:"12px 16px",border:"1px solid #f0f0f0",borderRadius:8,marginBottom:12},children:[e.jsx(i,{strong:!0,style:{display:"block",marginBottom:8},children:"Diagnostics"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(i,{children:"Enable debug logging"}),e.jsx(T,{checked:v,onChange:t=>$(t),disabled:!o||!p})]}),e.jsx(i,{type:"secondary",style:{fontSize:12},children:"Useful for support; logs will be visible in browser console."})]})]})]})})]}),e.jsx(ne,{title:"Change Profile Image",open:G,onCancel:()=>{C(!1)},onOk:()=>{C(!1)},okText:"Save",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsx(i,{children:"Enter a valid image URL for your profile picture:"}),e.jsx(V,{value:d,onChange:t=>{E(t.target.value)},placeholder:"https://example.com/image.jpg",size:"middle",type:"url"}),d&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(i,{type:"secondary",style:{display:"block",marginBottom:"8px"},children:"Preview:"}),e.jsx(H,{size:64,src:d,icon:e.jsx(A,{}),onError:()=>!0})]})]})})]})})}function Ce(){const{message:s}=ue.useApp(),{user:a}=m(c=>c.auth),[h,n]=l.useState(null),[r,u]=l.useState(!0);l.useEffect(()=>{y()},[]);const y=async()=>{u(!0);try{const f=(await I.getPeople()).find(o=>o.userId===a?.uid);if(f)n(f);else{const o={firstName:a?.displayName?.split(" ")[0]||"User",lastName:a?.displayName?.split(" ").slice(1).join(" ")||"",email:a?.email||"",roles:["parent"]},x=await I.createPerson(o,a?.uid||"");await I.linkPersonToAccount(x,a?.uid||"");const S={id:x,...o,hasAccount:!0,userId:a?.uid,roles:[],contactPreferences:[],programs:[],teams:[],groups:[],source:"signup",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),createdBy:a?.uid||"",isActive:!0};n(S)}}catch(c){console.error("âŒ Error loading profile:",c),s.error("Failed to load profile information")}finally{u(!1)}};return r?e.jsx("div",{style:{padding:24,textAlign:"center"},children:e.jsx(he,{size:"large"})}):h?e.jsx("div",{style:{padding:24},children:e.jsx(fe,{person:h,onPersonUpdate:c=>{n(c)},showThemeToggle:!0})}):e.jsxs(Q,{style:{textAlign:"center"},children:[e.jsx(A,{style:{fontSize:48,color:"#999",marginBottom:16}}),e.jsx("p",{children:"Unable to load profile information"})]})}export{Ce as default};
