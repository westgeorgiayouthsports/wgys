import{l as I,j as e,Q as xe}from"./index-lWfxYzVq.js";import{f as je,u as ge,r as p}from"./vendor-router-Ck4ZuSP9.js";import{a as fe}from"./vendor-redux-BbD-gcRX.js";import{p as K}from"./firebasePrograms-DQfL_YhU.js";import{s as ye}from"./firebaseSeasons-BgcPTcUq.js";import{S as H}from"./season-CjhZh6iC.js";import{p as ve}from"./firebaseProgramRegistrations-CcV5GOOA.js";import{F as be,G as o,a8 as m,S as u,x as we,B as c,H as T,ax as X,ae as Se,W as P,X as d,I as B,ad as Z,ak as k,d as l,a9 as F,a2 as De,a5 as Ie,a6 as Pe,af as Ce,ag as Me,ah as Ee,ab as Oe,M as ke}from"./vendor-antd-CieyQibU.js";import{R as ee}from"./Register-Bha_xe8Q.js";import{n as Fe,g as Ge,a as Re,b as Ye}from"./season-wVjdxr9p.js";import"./vendor-react-Ck9bq5u-.js";import"./vendor-firebase-BzUsRx-X.js";import"./slugify-IzZIKjBC.js";import"./firebaseTeams-DYGNnM-E.js";import"./storageService-BGD7Twul.js";const{Title:te,Text:x}=we,{TextArea:A}=B;function He(){const{programId:G}=je(),C=ge(),{role:N}=fe(t=>t.auth),{message:f}=be.useApp(),[b,M]=p.useState(!1),_=["Babe Ruth","Willie Mays","Barry Bonds","Ken Griffey Jr.","Derek Jeter","Hank Aaron","Tony Gwynn","Cal Ripken Jr.","Joe DiMaggio","Roberto Clemente","Ted Williams","Stan Musial","Sandy Koufax","Nolan Ryan","Greg Maddux"],q=_[Math.floor(Math.random()*_.length)],$=q.split(" "),R=$.shift()||q,Y=$.join(" ")||"",U=t=>{const s="2010-06-01";if(!t)return[{id:"sample-athlete-1",firstName:R,lastName:Y,roles:["athlete"],dateOfBirth:s,sex:"male"}];try{const i=t.birthDateStart?m(t.birthDateStart):null,a=t.birthDateEnd?m(t.birthDateEnd):null;if(i&&a&&a.isAfter(i)){const n=i.valueOf(),h=a.valueOf(),D=n+Math.floor(Math.random()*(h-n+1));return[{id:"sample-athlete-1",firstName:R,lastName:Y,roles:["athlete"],dateOfBirth:m(D).format("YYYY-MM-DD"),sex:"male"}]}}catch{}return[{id:"sample-athlete-1",firstName:R,lastName:Y,roles:["athlete"],dateOfBirth:s,sex:"male"}]},V={name:"Admin Preview Parent",email:"admin+preview@example.com",phone:"555-0100"},[r,w]=p.useState(null),[re,se]=p.useState(0),[ie,z]=p.useState(!0),[Q,J]=p.useState([]),[ne,S]=p.useState(!1),[g,W]=p.useState(null),[y]=o.useForm(),[j]=o.useForm(),ae=N==="admin"||N==="owner";p.useEffect(()=>{G&&le(),oe()},[G]);const oe=async()=>{try{const t=await ye.getSeasons();J(t.filter(s=>s.status===H.active))}catch(t){I.error("Failed to load seasons",t),J([])}},le=async()=>{z(!0);try{const s=(await K.getPrograms()).find(i=>i.id===G);if(s){const i={...s,questions:s.questions||[]};w(i);try{const a=await ve.getProgramRegistrationsByProgram(s.id),n=["pending","confirmed"],h=a.filter(D=>n.includes(D.status)).length;se(h)}catch(a){I.error("Error loading program registration metrics",a)}}else f.error("Program not found")}catch(t){I.error("❌ Error loading program:",t),f.error("Failed to load program")}finally{z(!1)}};p.useEffect(()=>{r&&j.setFieldsValue({...r,femaleOnlyToggle:r.sexRestriction||"any",registrationOpen:r.registrationOpen?m(r.registrationOpen):null,registrationClose:r.registrationClose?m(r.registrationClose):null,birthDateStart:r.birthDateStart?m(r.birthDateStart):null,birthDateEnd:r.birthDateEnd?m(r.birthDateEnd):null,seasonId:r.seasonId||void 0,basePrice:r.basePrice||0,private:r.private||!1,maxParticipants:r.maxParticipants})},[r,j]);const de=()=>{W(null),y.resetFields(),S(!0)},ce=t=>{W(t),y.setFieldsValue(t),S(!0)},he=t=>{if(!r)return;const s=(r.questions||[]).filter(i=>i.id!==t);w({...r,questions:s}),f.success("Question deleted")},L=(t,s)=>{if(!r)return;const i=[...r.questions||[]],a=i.findIndex(n=>n.id===t);s==="up"&&a>0?[i[a],i[a-1]]=[i[a-1],i[a]]:s==="down"&&a<i.length-1&&([i[a],i[a+1]]=[i[a+1],i[a]]),i.forEach((n,h)=>n.order=h),w({...r,questions:i})},me=t=>{if(!r)return;const s={id:g?.id||`q_${Date.now()}`,type:t.type,title:t.title,description:t.description||void 0,required:t.required===!0,options:t.options&&t.options.length>0?t.options:void 0,waiverText:t.waiverText||void 0,order:g?.order??(r.questions||[]).length};let i;g?i=(r.questions||[]).map(a=>a.id===g.id?s:a):i=[...r.questions||[],s],w({...r,questions:i}),S(!1),y.resetFields(),f.success(g?"Question updated":"Question added")},pe=t=>t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()),ue=()=>xe.map(s=>({value:s,label:s==="file_upload"?"Upload File":pe(s)})).sort((s,i)=>s.label.localeCompare(i.label));return ie||!r?e.jsx("div",{children:"Loading..."}):!ae&&r?e.jsx("div",{className:"page-container full-width",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(u,{style:{width:"100%",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(te,{level:2,style:{margin:0},children:r.name}),e.jsx(x,{type:"secondary",children:"Program Details"})]}),e.jsxs("div",{style:{marginTop:8,fontSize:13},children:[e.jsxs("div",{children:["Season: ",(()=>{if(!r)return"—";if(r.season&&typeof r.season=="object"&&r.season.name)return r.season.name;const t=r.seasonId||(typeof r.season=="string"?r.season:void 0);return Q.find(i=>i.id===t)?.name||t||"—"})()]}),e.jsxs("div",{children:["Birth Date Range: ",r.birthDateStart?m(r.birthDateStart).format("MMM D, YYYY"):"—"," to ",r.birthDateEnd?m(r.birthDateEnd).format("MMM D, YYYY"):"—"]}),e.jsxs("div",{children:["Price: $",(r.basePrice||0).toFixed(2)]})]})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(u,{children:[e.jsx(c,{type:"primary",onClick:()=>C(`/register/${r.id}`),children:"Register"}),e.jsx(c,{onClick:()=>C("/register"),children:"Open Register"})]})})]})}),e.jsx(T,{title:"Description",style:{marginBottom:"24px"},children:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.description||"No description available"}})})]})}):b&&r?e.jsx("div",{className:"page-container full-width",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx(u,{style:{width:"100%",justifyContent:"space-between",alignItems:"flex-start"},children:e.jsx(c,{icon:e.jsx(X,{}),onClick:()=>M(!1),children:"Back to Edit"})})}),e.jsx(ee,{program:r,isPreview:!0,familyMembers:U(r),parentInfo:V,onClose:()=>M(!1)})]})}):e.jsx("div",{className:"page-container full-width",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs(u,{style:{width:"100%",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(u,{orientation:"vertical",style:{flex:1},children:[e.jsx(c,{icon:e.jsx(X,{}),onClick:()=>C("/admin/programs"),children:"Back to Programs"}),e.jsxs("div",{children:[e.jsx(te,{level:2,style:{margin:0},children:r.name}),e.jsx(x,{type:"secondary",children:"Program Form Configuration"})]})]}),e.jsxs(u,{children:[e.jsx(c,{onClick:()=>C(`/admin/programs/${r.id}/teams`),children:"Manage Teams"}),e.jsx(c,{onClick:()=>M(!b),children:b?"Edit":"Preview"}),e.jsx(c,{type:"primary",icon:e.jsx(Se,{}),onClick:()=>{j.submit()},children:"Save Program"})]})]})}),b&&e.jsx("div",{style:{marginBottom:16},children:e.jsx(ee,{program:r,isPreview:!0,familyMembers:U(r),parentInfo:V,onClose:()=>M(!1)})}),e.jsx(T,{title:"Program Details",style:{marginBottom:"24px"},children:e.jsxs(o,{form:j,layout:"vertical",onFinish:t=>{if(!r)return;const s=t.sexRestriction||"any",i=(r.questions||[]).map(n=>{const h={id:n.id,type:n.type,title:n.title,required:n.required===!0,order:n.order};return n.description&&(h.description=n.description),n.options&&n.options.length>0&&(h.options=n.options),n.waiverText&&(h.waiverText=n.waiverText),h}),a={...r,...t,sexRestriction:s,questions:i,registrationOpen:t.registrationOpen?.format("YYYY-MM-DD"),registrationClose:t.registrationClose?.format("YYYY-MM-DD"),birthDateStart:t.birthDateStart?.format("YYYY-MM-DD"),birthDateEnd:t.birthDateEnd?.format("YYYY-MM-DD")};K.updateProgram(r.id,{...a,updatedAt:new Date().toISOString()}).then(()=>{w(a),f.success("Program updated successfully!")}).catch(n=>{I.error("❌ Error saving program:",n),f.error("Failed to save program")})},children:[e.jsxs(P,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"name",label:"Program Name",rules:[{required:!0}],children:e.jsx(B,{placeholder:"Enter program name"})})}),e.jsx(d,{span:6,children:e.jsx(o.Item,{name:"basePrice",label:"Base Amount",rules:[{required:!1}],children:e.jsx(Z,{style:{width:"100%"},min:0,formatter:t=>`$${t}`,parser:t=>String(t).replace(/\$|,/g,"")})})}),e.jsx(d,{span:6,children:e.jsx(o.Item,{name:"active",label:"Active",valuePropName:"checked",children:e.jsx(k,{checkedChildren:"Yes",unCheckedChildren:"No"})})}),e.jsx(d,{span:6,children:e.jsx(o.Item,{name:"sexRestriction",label:"Sex Restriction",children:e.jsxs(l,{children:[e.jsx(l.Option,{value:"any",children:"Any"}),e.jsx(l.Option,{value:"male",children:"Male"}),e.jsx(l.Option,{value:"female",children:"Female"})]})})}),e.jsx(d,{span:6,children:e.jsx(o.Item,{name:"private",label:"Private (invite only)",valuePropName:"checked",children:e.jsx(k,{checkedChildren:"Yes",unCheckedChildren:"No"})})}),e.jsx(d,{span:6,children:e.jsx(o.Item,{name:"maxParticipants",label:"Participant Limit",children:e.jsx(Z,{style:{width:"100%"},min:0,placeholder:"Unlimited if empty"})})}),e.jsx(d,{span:6,children:e.jsx(o.Item,{name:"seasonId",label:"Season",children:e.jsxs(l,{placeholder:"Select season",children:[e.jsx(l.Option,{value:void 0,children:"None"}),Q.map(t=>e.jsxs(l.Option,{value:t.id,children:[t.name," ",t.status===H.archived?"(Archived)":""]},t.id))]})})})]}),e.jsx(o.Item,{name:"description",label:"Description",children:e.jsx(A,{rows:3,placeholder:"Program description"})}),e.jsxs(P,{gutter:16,style:{marginBottom:12},children:[e.jsxs(d,{span:8,children:[e.jsx(x,{strong:!0,children:"Current Registrants:"}),e.jsx("div",{children:e.jsxs(x,{children:[re,r.maxParticipants?` / ${r.maxParticipants}`:""]})})]}),e.jsx(d,{span:8})]}),e.jsxs(P,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"registrationOpen",label:"Registration Start",children:e.jsx(F,{style:{width:"100%"}})})}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"registrationClose",label:"Registration End",children:e.jsx(F,{style:{width:"100%"}})})})]}),e.jsxs(P,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"birthDateStart",label:"Birth Date Start",children:e.jsx(F,{style:{width:"100%"}})})}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"birthDateEnd",label:"Birth Date End",children:e.jsx(F,{style:{width:"100%"}})})})]}),e.jsxs(P,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{noStyle:!0,shouldUpdate:(t,s)=>t.birthDateStart!==s.birthDateStart||t.allowGradeExemption!==s.allowGradeExemption,children:({getFieldValue:t})=>{const s=t("allowGradeExemption"),i=t("birthDateStart");if(s&&i)try{const a=j.getFieldValue("seasonId");let n;if(a){const v=Q.find(O=>O.id===a);v&&(n=Fe(v))}if(!n){const v=m(),O=v.month()>=7;n={term:O?"fall":"spring",year:O?v.year()+1:v.year()}}const h=j.getFieldValue("sport"),D=Ge(n,h),E=Re(i,D);E&&E>=0&&E<=12&&setTimeout(()=>{j.setFieldsValue({maxGrade:E})},0)}catch(a){I.error("Error calculating max grade from birth date start",a);const n=Ye(i);n>=0&&n<=12&&setTimeout(()=>{j.setFieldsValue({maxGrade:n})},0)}return e.jsx(o.Item,{name:"maxGrade",label:"Maximum Grade",children:e.jsxs(l,{style:{width:"100%"},placeholder:"Select grade",children:[e.jsx(l.Option,{value:0,children:"Kindergarten"}),e.jsx(l.Option,{value:1,children:"1st Grade"}),e.jsx(l.Option,{value:2,children:"2nd Grade"}),e.jsx(l.Option,{value:3,children:"3rd Grade"}),e.jsx(l.Option,{value:4,children:"4th Grade"}),e.jsx(l.Option,{value:5,children:"5th Grade"}),e.jsx(l.Option,{value:6,children:"6th Grade"}),e.jsx(l.Option,{value:7,children:"7th Grade"}),e.jsx(l.Option,{value:8,children:"8th Grade"}),e.jsx(l.Option,{value:9,children:"9th Grade"}),e.jsx(l.Option,{value:10,children:"10th Grade"}),e.jsx(l.Option,{value:11,children:"11th Grade"}),e.jsx(l.Option,{value:12,children:"12th Grade"})]})})}})}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"allowGradeExemption",label:"Allow Grade Exemptions",valuePropName:"checked",children:e.jsx(k,{})})})]})]})}),!b&&e.jsx(T,{title:"Registration Form Questions",extra:e.jsx(c,{type:"primary",icon:e.jsx(Oe,{}),onClick:de,children:"Add Question"}),children:e.jsx(De,{dataSource:(r.questions||[]).sort((t,s)=>t.order-s.order),locale:{emptyText:'No questions added yet. Click "Add Question" to get started.'},pagination:!1,rowKey:"id",columns:[{title:"Question",key:"question",render:t=>e.jsxs("div",{children:[e.jsxs(u,{children:[e.jsx(x,{strong:!0,children:t.title}),t.required&&e.jsx(x,{type:"danger",children:"*"}),e.jsxs(x,{type:"secondary",children:["(",t.type.replace("_"," "),")"]})]}),t.description&&e.jsx("div",{children:e.jsx(x,{type:"secondary",children:t.description})})]})},{title:"Actions",key:"actions",width:200,render:(t,s,i)=>e.jsxs(u,{children:[e.jsx(c,{size:"small",icon:e.jsx(Ie,{}),disabled:i===0,onClick:()=>{L(t.id,"up")}}),e.jsx(c,{size:"small",icon:e.jsx(Pe,{}),disabled:i===(r.questions||[]).length-1,onClick:()=>{L(t.id,"down")}}),e.jsx(c,{size:"small",icon:e.jsx(Ce,{}),onClick:()=>{ce(t)}}),e.jsx(Me,{title:"Delete Question",description:"Are you sure you want to delete this question?",onConfirm:()=>{he(t.id)},children:e.jsx(c,{size:"small",danger:!0,icon:e.jsx(Ee,{})})})]})}]})}),e.jsx(ke,{title:g?"Edit Question":"Add Question",open:ne,onCancel:()=>{S(!1),y.resetFields()},footer:null,width:600,children:e.jsxs(o,{form:y,layout:"vertical",onFinish:me,children:[e.jsx(o.Item,{name:"type",label:"Question Type",rules:[{required:!0}],children:e.jsx(l,{placeholder:"Select question type",options:ue()})}),e.jsx(o.Item,{noStyle:!0,shouldUpdate:(t,s)=>t.type!==s.type,children:({getFieldValue:t})=>{const s=t("type"),a={short_answer:"e.g., Player's preferred position",paragraph:"e.g., Please provide medical information or special instructions",dropdown:"e.g., Select player's grade",checkboxes:"e.g., Select all positions played",file_upload:"e.g., Upload player's birth certificate (PDF/JPG)",waiver:"e.g., I agree to the waiver terms",numeric:"e.g., Enter a whole number (0, 1, 2...)",jersey_number:"e.g., Jersey number (0–99, 00 allowed)"}[s]||"e.g., What school does the player attend?";return e.jsx(o.Item,{name:"title",label:"Question Title",rules:[{required:!0}],children:e.jsx(B,{placeholder:a})})}}),e.jsx(o.Item,{name:"description",label:"Description (Optional)",children:e.jsx(A,{rows:2,placeholder:"Additional instructions or context..."})}),e.jsx(o.Item,{name:"required",label:"Required",valuePropName:"checked",children:e.jsx(k,{})}),e.jsx(o.Item,{noStyle:!0,shouldUpdate:(t,s)=>t.type!==s.type,children:({getFieldValue:t})=>{const s=t("type");return s==="dropdown"||s==="checkboxes"?e.jsx(o.Item,{name:"options",label:"Options",rules:[{required:!0}],children:e.jsx(l,{mode:"tags",placeholder:"Type options and press Enter",style:{width:"100%"}})}):s==="waiver"?e.jsx(o.Item,{name:"waiverText",label:"Waiver Text",rules:[{required:!0}],children:e.jsx(A,{rows:4,placeholder:"Enter the legal agreement text..."})}):s==="jersey_number"?e.jsx(o.Item,{children:e.jsx(x,{type:"secondary",children:"Use this to collect player jersey numbers. Valid values: 0–99. Enter '00' to represent double zero."})}):null}}),e.jsx(o.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(u,{children:[e.jsx(c,{onClick:()=>{S(!1),y.resetFields()},children:"Cancel"}),e.jsx(c,{type:"primary",htmlType:"submit",children:g?"Update Question":"Add Question"})]})})]})})]})})}export{He as default};
