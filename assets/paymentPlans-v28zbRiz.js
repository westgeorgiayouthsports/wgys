import{n as y,o,z as u,x as g,t as w}from"./vendor-firebase-BzUsRx-X.js";import{e as s,q as p,A as d,l as n}from"./index-lWfxYzVq.js";const E={async getPaymentPlans(){try{const t=await y(o(s,"paymentPlans"));if(!t.exists())return[];const e=t.val();return Object.entries(e).map(([a,r])=>({id:a,...r}))}catch(t){n.error("Error fetching payment plans",t);const e=t?.code||"",a=t?.message||String(t||"");if(e==="PERMISSION_DENIED"||a.toLowerCase().includes("permission"))throw t;return[]}},async getPaymentPlanById(t){try{const e=await y(o(s,`paymentPlans/${t}`));return e.exists()?{id:t,...e.val()}:null}catch(e){return n.error("Error fetching payment plan",e),null}},async createPaymentPlan(t,e){try{const a=o(s,"paymentPlans"),r=new Date().toISOString(),c={...Object.fromEntries(Object.entries(t||{}).filter(([m,P])=>P!==void 0&&P!=="")),createdAt:r,updatedAt:r,createdBy:e||null},l=await w(a,c);try{await p.log({action:"paymentPlan.created",entityType:d.PaymentPlan,entityId:l.key,details:c})}catch(m){n.error("Error auditing paymentPlan.created",m)}return l.key}catch(a){throw n.error("Error creating payment plan",a),a}},async updatePaymentPlan(t,e){try{const a=o(s,`paymentPlans/${t}`),i={...Object.fromEntries(Object.entries(e||{}).filter(([c,l])=>l!==void 0&&l!=="")),updatedAt:new Date().toISOString()};await g(a,i);try{await p.log({action:"paymentPlan.updated",entityType:d.PaymentPlan,entityId:t,details:i})}catch(c){n.error("Error auditing paymentPlan.updated",c)}}catch(a){throw n.error("Error updating payment plan",a),a}},async deletePaymentPlan(t){try{const e=await y(o(s,`paymentPlans/${t}`)),a=e.exists()?e.val():null;await u(o(s,`paymentPlans/${t}`));try{await p.logDelete(d.PaymentPlan,t,a)}catch(r){n.error("Error auditing paymentPlan.deleted",r)}}catch(e){throw n.error("Error deleting payment plan",e),e}}};export{E as p};
