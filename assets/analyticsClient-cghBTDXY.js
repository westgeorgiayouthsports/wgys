import{y as l}from"./index-lWfxYzVq.js";const c="/api/metrics/views";function h(t){if(!t)return c;const e=t.trim();return e.startsWith("/")?e.endsWith("/views")?e:`${e.replace(/\/+$/,"")}/views`:/^https?:\/\//i.test(e)?e.includes("/api/metrics")?e.endsWith("/views")?e:`${e.replace(/\/+$/,"")}/views`:`${e.replace(/\/+$/,"")}/api/metrics/views`:`https://${e.replace(/^\/+|\/+$/g,"")}/api/metrics/views`}const m=l("VITE_METRICS_URL"),n=h(m);async function p(){const t=n===c?[c]:[n,c];for(const e of t)try{const i=await fetch(e,{headers:{Accept:"application/json"}});if(!i.ok)throw new Error(`Failed to fetch views: ${i.status}`);const s=await i.json(),o=typeof s.views=="number"?s.views:0,r=typeof s.realtimeViews=="number"?s.realtimeViews:void 0;return{views:o,healthy:!0,realtimeViews:r,source:s.source}}catch(i){console.error("fetchWebsiteMetrics error",e,i)}return{views:0,healthy:!1}}async function y(t=7){const e=t===1?"&granularity=hour":"",i=n===c?[`${c}?timeseries=true&days=${t}${e}`]:[`${n}?timeseries=true&days=${t}${e}`,`${c}?timeseries=true&days=${t}${e}`];for(const s of i)try{const o=await fetch(s,{headers:{Accept:"application/json"}});if(!o.ok)throw new Error(`Failed to fetch trends: ${o.status}`);const r=await o.json(),f=r.timeseries||[],a=typeof r.views=="number"?r.views:void 0,u=typeof r.realtimeViews=="number"?r.realtimeViews:void 0;if(f.length)return{timeseries:f,source:r.source,healthy:!0,views:a,realtimeViews:u};if(typeof a=="number"||typeof u=="number")return{timeseries:[],source:r.source,healthy:!0,views:a,realtimeViews:u}}catch(o){console.error("fetchWebsiteTrends error",s,o)}return{timeseries:[],source:void 0,healthy:!1}}export{p as a,y as f};
