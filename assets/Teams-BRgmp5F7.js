const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-lWfxYzVq.js","assets/vendor-react-Ck9bq5u-.js","assets/vendor-router-Ck4ZuSP9.js","assets/vendor-antd-CieyQibU.js","assets/vendor-redux-BbD-gcRX.js","assets/vendor-firebase-BzUsRx-X.js","assets/index-C63fGlVj.css"])))=>i.map(i=>d[i]);
import{_ as E,a as W,s as Q,b as xe,j as a,c as je,d as ye}from"./index-lWfxYzVq.js";import{r as m,u as fe}from"./vendor-router-Ck4ZuSP9.js";import{u as Ie,a as k}from"./vendor-redux-BbD-gcRX.js";import{A as Te}from"./AdminPageHeader-BidreVSQ.js";import{t as x}from"./firebaseTeams-DYGNnM-E.js";import{p as we}from"./firebasePrograms-DQfL_YhU.js";import{s as be}from"./firebaseSeasons-BgcPTcUq.js";import{S as $,B as f,aa as Ce,ab as X,x as ve,W as M,X as u,H as w,$ as N,ac as Se,M as Me,a2 as Y,G as h,d as o,I as J,ad as Oe,ae as Ae,Q as Z,a0 as D,T as Fe,af as _e,ag as Ee,ah as ke}from"./vendor-antd-CieyQibU.js";import"./vendor-react-Ck9bq5u-.js";import"./vendor-firebase-BzUsRx-X.js";import"./slugify-IzZIKjBC.js";import"./season-CjhZh6iC.js";const{Title:$e,Text:b}=ve;function Ke(){const j=Ie(),p=k(e=>e.auth.user),O=k(e=>e.auth.role),g=k(e=>e.teams.teams),P=k(e=>e.teams.loading),[C,R]=m.useState(null),[A,F]=m.useState(!1),[ee,V]=m.useState(null),[z,I]=m.useState(""),[v,ae]=m.useState([]),[G,se]=m.useState([]),[H,te]=m.useState("teams"),[_,ne]=m.useState([]),[q,re]=m.useState([]);m.useEffect(()=>{p?.uid&&(T(),de(),ie(),le())},[p?.uid]);const ie=async()=>{try{const e=await we.getPrograms();ne(e);try{const t=await be.getSeasons();re(t||[])}catch(t){console.error("Failed to load seasons:",t)}}catch(e){console.error("Failed to load programs:",e)}};m.useEffect(()=>{A||(R(null),I(""),V(null))},[A]);const oe=({initialTeam:e,editingIdProp:t,onSubmit:s,onCancel:i,coachesProp:n,managersProp:l})=>{const[d]=h.useForm();return m.useEffect(()=>{e&&t?d.setFieldsValue({programId:e.programId||void 0,name:e.name||"",budget:e.budget||0,status:e.status||"active",coachId:e.coachId||void 0,assistantCoachIds:e.assistantCoachIds||[],teamManagerId:e.teamManagerId||void 0}):(d.resetFields(),d.setFieldsValue({status:"active"}))},[e,t,d]),a.jsxs(h,{form:d,layout:"vertical",onFinish:s,children:[z&&a.jsx("div",{style:{marginBottom:12,color:"#ff4d4f"},children:z}),a.jsxs(M,{gutter:16,children:[a.jsx(u,{span:12,children:a.jsx(h.Item,{name:"programId",label:"Program",rules:[{required:!0,message:"Select a program"}],children:a.jsx(o,{placeholder:"Select program",showSearch:{filterOption:(r,c)=>{const y=c?.label??c?.children;return String(y||"").toLowerCase().includes(String(r).toLowerCase())}},children:_.map(r=>{const c=r?.season&&typeof r.season=="object"&&r.season.name?r.season.name:r.seasonId||(typeof r.season=="string"?r.season:void 0),y=q.find(S=>S.id===c)?.name||c,B=`${y?y+" - ":""}${r.name}`;return a.jsx(o.Option,{value:r.id,label:B,children:B},r.id)})})})}),a.jsx(u,{span:12,children:a.jsx(h.Item,{name:"name",label:"Team Name",rules:[{required:!0,message:"Please enter team name"}],children:a.jsx(J,{placeholder:"e.g., 12U Softball"})})}),a.jsx(u,{span:6,children:a.jsx(h.Item,{name:"budget",label:"Budget ($)",rules:[{required:!0,message:"Please enter budget"}],children:a.jsx(Oe,{style:{width:"100%"},min:0,step:.01,placeholder:"0.00"})})}),a.jsx(u,{span:6,children:a.jsx(h.Item,{name:"status",label:"Status",children:a.jsxs(o,{children:[a.jsx(o.Option,{value:"active",children:"Active"}),a.jsx(o.Option,{value:"inactive",children:"Inactive"})]})})})]}),a.jsx(M,{gutter:16,children:a.jsx(u,{span:12,children:a.jsx(h.Item,{label:"Season",children:a.jsx(J,{value:(()=>{const r=d.getFieldValue("programId")||e?.programId,c=_.find(S=>S.id===r);if(!c)return"";if(c.season&&typeof c.season=="object"&&c.season.name)return c.season.name;const y=c.seasonId||(typeof c.season=="string"?c.season:void 0);return q.find(S=>S.id===y)?.name||y||""})(),disabled:!0})})})}),a.jsx(M,{gutter:16,children:a.jsx(u,{span:24,children:a.jsx(h.Item,{name:"coachId",label:"Coach",children:a.jsxs(o,{allowClear:!0,placeholder:"Assign a coach",children:[a.jsx(o.Option,{value:"",children:"Unassigned"}),n.map(r=>a.jsx(o.Option,{value:r.uid,title:r.email,children:r.displayName||r.email?.split("@")[0]},r.uid))]})})})}),a.jsxs(M,{gutter:16,children:[a.jsx(u,{span:12,children:a.jsx(h.Item,{name:"assistantCoachIds",label:"Assistant Coaches",children:a.jsx(o,{mode:"multiple",allowClear:!0,placeholder:"Assign assistant coaches",children:n.map(r=>a.jsx(o.Option,{value:r.uid,title:r.email,children:r.displayName||r.email?.split("@")[0]},r.uid))})})}),a.jsx(u,{span:12,children:a.jsx(h.Item,{name:"teamManagerId",label:"Team Manager",children:a.jsxs(o,{allowClear:!0,placeholder:"Assign a team manager",children:[a.jsx(o.Option,{value:"",children:"Unassigned"}),l.map(r=>a.jsx(o.Option,{value:r.uid,title:r.email,children:r.displayName||r.email?.split("@")[0]},r.uid))]})})})]}),a.jsx(h.Item,{style:{textAlign:"right",marginBottom:0},children:a.jsxs($,{children:[a.jsx(f,{onClick:i,children:"Cancel"}),a.jsx(f,{type:"primary",htmlType:"submit",icon:t?a.jsx(Ae,{}):a.jsx(X,{}),children:t?"Update Team":"Add Team"})]})})]})},de=async()=>{try{const{ref:e,get:t}=await E(async()=>{const{ref:n,get:l}=await import("./vendor-firebase-BzUsRx-X.js").then(d=>d.O);return{ref:n,get:l}},[]),{db:s}=await E(async()=>{const{db:n}=await import("./index-lWfxYzVq.js").then(l=>l.L);return{db:n}},__vite__mapDeps([0,1,2,3,4,5,6])),i=await t(e(s,"users"));if(i.exists()){const n=i.val(),l=Object.entries(n||{}).filter(([,d])=>["coach","admin","owner"].includes(d.role)).map(([d,r])=>({uid:d,...r}));ae(l)}}catch(e){console.error("Failed to load coaches:",e)}},le=async()=>{try{const{ref:e,get:t}=await E(async()=>{const{ref:n,get:l}=await import("./vendor-firebase-BzUsRx-X.js").then(d=>d.O);return{ref:n,get:l}},[]),{db:s}=await E(async()=>{const{db:n}=await import("./index-lWfxYzVq.js").then(l=>l.L);return{db:n}},__vite__mapDeps([0,1,2,3,4,5,6])),i=await t(e(s,"users"));if(i.exists()){const n=i.val(),l=Object.entries(n||{}).filter(([,d])=>["teamManager","admin","owner"].includes(d.role)).map(([d,r])=>({uid:d,...r}));se(l)}}catch(e){console.error("Failed to load managers:",e)}},T=async()=>{if(p?.uid){j(W(!0));try{const e=await x.getUserTeams(p.uid);j(Q(e)),I("")}catch(e){const t=e instanceof Error?e.message:"Failed to load teams";I(t),j(xe(t))}finally{j(W(!1))}}},ce=fe(),me=async e=>{if(p?.uid)try{const t=parseFloat(e.budget||0);if(I(""),C){const s=_.find(n=>n.id===e.programId);await x.updateTeam(C,{name:e.name,budget:t,status:e.status,coachId:e.coachId||void 0,assistantCoachIds:e.assistantCoachIds||[],teamManagerId:e.teamManagerId||void 0,programId:e.programId,seasonId:s?.seasonId,season:s?.season,year:s?.year,ageGroup:s?.ageGroup});const i=g.map(n=>n.id===C?{...n,name:e.name,budget:t,status:e.status,coachId:e.coachId,programId:e.programId,seasonId:s?.seasonId,season:s?.season,year:s?.year,ageGroup:s?.ageGroup}:n);j(Q(i)),Z.success("Team updated")}else{const s=_.find(n=>n.id===e.programId),i=await x.createTeam({name:e.name,budget:t,spent:0,status:e.status,userId:p.uid,createdAt:new Date().toISOString(),coachId:e.coachId||void 0,assistantCoachIds:e.assistantCoachIds||[],teamManagerId:e.teamManagerId||void 0,programId:e.programId,seasonId:s?.seasonId,season:s?.season,year:s?.year,ageGroup:s?.ageGroup});j(je(i)),Z.success("Team created")}F(!1)}catch(t){const s=t instanceof Error?t.message:"Operation failed";I(s)}},ue=e=>{const t=g.find(s=>s.id===e);t&&(V(t),R(e),F(!0))},he=async e=>{if(confirm("Are you sure you want to delete this team?"))try{await x.deleteTeam(e),j(ye(e))}catch(t){const s=t instanceof Error?t.message:"Delete failed";I(s)}},K=()=>{F(!1)},L=g.reduce((e,t)=>e+(t.budget||0),0),U=g.reduce((e,t)=>e+(t.spent||0),0),pe=[{title:"Team Name",dataIndex:"name",key:"name",render:e=>a.jsx(b,{strong:!0,children:e||"Unnamed Team"})},{title:"Status",dataIndex:"status",key:"status",render:e=>a.jsx(D,{color:(e||"active")==="active"?"green":"default",children:(e||"active").toUpperCase()})},{title:"Budget",dataIndex:"budget",key:"budget",render:e=>`$${(e||0).toFixed(2)}`},{title:"Spent",dataIndex:"spent",key:"spent",render:e=>`$${(e||0).toFixed(2)}`},{title:"Remaining",key:"remaining",render:e=>{const t=(e.budget||0)-(e.spent||0);return a.jsxs(b,{style:{color:t>=0?"#52c41a":"#ff4d4f"},children:["$",t.toFixed(2)]})}},{title:"Created By",dataIndex:"userId",key:"userId",render:e=>e===p?.uid?p?.displayName||p?.email?.split("@")[0]:e?"Other User":a.jsx(b,{type:"secondary",children:"Demo"})},{title:"Coach",dataIndex:"coachId",key:"coachId",render:(e,t)=>{const s=v.find(n=>n.uid===e);return O==="admin"||O==="owner"?a.jsxs(o,{size:"small",style:{width:150},value:e||void 0,placeholder:"Select coach",onChange:async n=>{try{await x.updateTeam(t.id,{coachId:n}),await T()}catch(l){console.error("Failed to update coach:",l)}},children:[a.jsx(o.Option,{value:"",children:"Unassigned"}),v.map(n=>a.jsx(o.Option,{value:n.uid,title:n.email,children:n.displayName||n.email?.split("@")[0]},n.uid))]}):s?a.jsx(Fe,{title:s.email,children:s.displayName||s.email?.split("@")[0]}):a.jsx(b,{type:"secondary",children:"Unassigned"})}},{title:"Staff",key:"staff",render:e=>a.jsxs($,{wrap:!0,children:[a.jsxs(D,{color:e.coachId?"green":"default",children:["Head Coach",e.coachId?"":": none"]}),a.jsxs(D,{color:e.teamManagerId?"blue":"default",children:["Manager",e.teamManagerId?"":": none"]}),a.jsxs(D,{color:(e.assistantCoachIds?.length||0)>0?"purple":"default",children:["Assistants: ",e.assistantCoachIds?.length||0]})]})},{title:"Actions",key:"actions",render:e=>{const t=e.userId===p?.uid,s=O==="admin"||O==="owner",i=t||s,n=!e.userId;return a.jsxs($,{children:[a.jsx(f,{size:"small",onClick:()=>{ce(`/teams/${e.id}/chat`)},title:"Open Team Chat",children:"Chat"}),a.jsx(f,{size:"small",icon:a.jsx(_e,{}),onClick:()=>{ue(e.id)},disabled:n&&!s,title:n&&!s?"Demo team - read only":""}),a.jsx(Ee,{title:"Delete Team",description:"Are you sure you want to delete this team?",onConfirm:()=>he(e.id),disabled:!i||n,children:a.jsx(f,{size:"small",danger:!0,icon:a.jsx(ke,{}),disabled:!i||n,title:n?"Demo team - cannot delete":i?"":"Only team creator can delete"})})]})}}],ge=[{title:"Team",dataIndex:"name",key:"name",render:e=>a.jsx(b,{strong:!0,children:e||"Unnamed Team"})},{title:"Head Coach",dataIndex:"coachId",key:"coachId",render:(e,t)=>a.jsx(o,{size:"small",style:{width:180},value:e||void 0,placeholder:"Select head coach",onChange:async s=>{try{await x.updateTeam(t.id,{coachId:s||void 0}),await T()}catch(i){console.error("Failed to update head coach:",i)}},allowClear:!0,children:v.map(s=>a.jsx(o.Option,{value:s.uid,title:s.email,children:s.displayName||s.email?.split("@")[0]},s.uid))})},{title:"Assistant Coaches",dataIndex:"assistantCoachIds",key:"assistantCoachIds",render:(e=[],t)=>a.jsx(o,{mode:"multiple",size:"small",style:{minWidth:220},value:e,placeholder:"Select assistant coaches",onChange:async s=>{try{await x.updateTeam(t.id,{assistantCoachIds:s}),await T()}catch(i){console.error("Failed to update assistant coaches:",i)}},allowClear:!0,children:v.map(s=>a.jsx(o.Option,{value:s.uid,title:s.email,children:s.displayName||s.email?.split("@")[0]},s.uid))})},{title:"Team Manager",dataIndex:"teamManagerId",key:"teamManagerId",render:(e,t)=>a.jsx(o,{size:"small",style:{width:200},value:e||void 0,placeholder:"Select team manager",onChange:async s=>{try{await x.updateTeam(t.id,{teamManagerId:s||void 0}),await T()}catch(i){console.error("Failed to update team manager:",i)}},allowClear:!0,children:G.map(s=>a.jsx(o.Option,{value:s.uid,title:s.email,children:s.displayName||s.email?.split("@")[0]},s.uid))})}];return a.jsxs("div",{className:"page-container",children:[a.jsx(Te,{title:a.jsxs(a.Fragment,{children:[a.jsx($e,{level:2,style:{margin:0},children:"Teams Management"}),a.jsx(b,{type:"secondary",children:"Manage your youth sports teams and budgets"})]}),actions:a.jsxs($,{children:[a.jsx(f,{icon:a.jsx(Ce,{}),onClick:T,loading:P,children:"Refresh"}),a.jsx(f,{type:"primary",icon:a.jsx(X,{}),onClick:()=>{R(null),F(!0)},children:"Add Team"})]})}),g.length>0&&a.jsxs(M,{gutter:16,style:{marginBottom:"24px"},children:[a.jsx(u,{span:6,children:a.jsx(w,{children:a.jsx(N,{title:"Total Teams",value:g.length})})}),a.jsx(u,{span:6,children:a.jsx(w,{children:a.jsx(N,{title:"Total Budget",value:L,precision:2,prefix:"$"})})}),a.jsx(u,{span:6,children:a.jsx(w,{children:a.jsx(N,{title:"Total Spent",value:U,precision:2,prefix:"$"})})}),a.jsx(u,{span:6,children:a.jsx(w,{children:a.jsx(N,{title:"Remaining",value:L-U,precision:2,prefix:"$",styles:{content:{color:L-U>=0?"#3f8600":"#cf1322"}}})})})]}),a.jsx(Se,{activeKey:H,onChange:te,items:[{key:"teams",label:`Teams (${g.length})`},{key:"staff",label:"Staff"}]}),a.jsx(Me,{title:C?"Edit Team":"Add New Team",open:A,onCancel:K,footer:null,width:700,children:A&&a.jsx(oe,{initialTeam:ee,editingIdProp:C,onSubmit:me,onCancel:K,coachesProp:v,managersProp:G})}),H==="teams"?a.jsx(w,{title:`Your Teams (${g.length})`,children:a.jsx(Y,{columns:pe,dataSource:g,rowKey:"id",loading:P,locale:{emptyText:"No teams yet. Create your first team above!"},pagination:!1})}):a.jsx(w,{title:"Team Staff",children:a.jsx(Y,{columns:ge,dataSource:g,rowKey:"id",loading:P,pagination:!1,locale:{emptyText:"No teams available"}})})]})}export{Ke as default};
