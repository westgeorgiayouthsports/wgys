import{j as e}from"./index-lWfxYzVq.js";import{u as X,r as s}from"./vendor-router-Ck4ZuSP9.js";import{a as Z}from"./vendor-redux-BbD-gcRX.js";import{p as R}from"./firebasePeople-B5ZBKo1U.js";import{p as ee}from"./firebaseProgramRegistrations-CcV5GOOA.js";import{t as te}from"./firebaseTeams-DYGNnM-E.js";import{p as se}from"./firebasePrograms-DQfL_YhU.js";import{F as ae,H as $,d as i,a3 as M,S,x as re,a8 as ie,a0 as N,s as oe,au as ne,av as le,aw as ce}from"./vendor-antd-CieyQibU.js";import"./vendor-react-Ck9bq5u-.js";import"./vendor-firebase-BzUsRx-X.js";import"./slugify-IzZIKjBC.js";const{Text:o}=re;function Ie(){const{message:b}=ae.useApp(),{user:T}=Z(t=>t.auth),B=X(),[I,D]=s.useState([]),[P,z]=s.useState([]),[w,O]=s.useState({}),[y,W]=s.useState(void 0),[x,k]=s.useState(void 0),[j,U]=s.useState(void 0),[f,c]=s.useState(1),[d]=s.useState(6),[Y,C]=s.useState(!0),[,L]=s.useState(null),[_,G]=s.useState({});s.useEffect(()=>{H()},[]);const H=async()=>{C(!0);try{const a=(await R.getPeople()).find(p=>p.userId===T?.uid);if(a?.familyId){L(a.familyId);const p=await R.getPeopleByFamily(a.familyId);D(p);const[g,n]=await Promise.all([ee.getProgramRegistrationsByFamily(a.familyId),se.getPrograms()]);z(g||[]);const l={};(n||[]).forEach(r=>{r.id&&(l[r.id]=r.name||r.id)}),O(l);const h=Array.from(new Set((g||[]).map(r=>r.programId).filter(Boolean))),K=await Promise.all(h.map(r=>te.getTeamsByProgram(r))),F={};h.forEach((r,Q)=>{(K[Q]||[]).forEach(v=>{(v.rosterAthleteIds||[]).forEach(V=>{F[`${r}:${V}`]=v.name||v.id})})}),G(F)}}catch(t){console.error("âŒ Error loading registrations:",t),b.error("Failed to load registrations")}finally{C(!1)}},q=t=>{switch(t){case"confirmed":return e.jsx(ce,{style:{color:"#52c41a"}});case"cancelled":return e.jsx(le,{style:{color:"#ff4d4f"}});default:return e.jsx(ne,{style:{color:"#faad14"}})}},J=t=>{switch(t){case"confirmed":return"success";case"cancelled":return"error";default:return"warning"}},A=P.filter(t=>!(y&&t.athleteId!==y||x&&t.programId!==x||j&&(t.status||"pending")!==j)),u=A.length,m=(f-1)*d,E=A.slice(m,m+d);return e.jsx("div",{style:{padding:24},children:e.jsxs($,{title:e.jsxs(S,{children:[e.jsx(oe,{}),e.jsx("span",{children:"Program Registrations"})]}),loading:Y,children:[e.jsxs("div",{style:{marginBottom:12,display:"flex",gap:12,flexWrap:"wrap"},children:[e.jsx(i,{allowClear:!0,placeholder:"Filter by athlete",style:{minWidth:200},value:y,onChange:t=>{W(t),c(1)},children:I.map(t=>e.jsx(i.Option,{value:t.id,children:`${t.firstName} ${t.lastName}`.trim()},t.id))}),e.jsx(i,{allowClear:!0,placeholder:"Filter by program",style:{minWidth:240},value:x,onChange:t=>{k(t),c(1)},children:Object.entries(w).map(([t,a])=>e.jsx(i.Option,{value:t,children:a},t))}),e.jsxs(i,{allowClear:!0,placeholder:"Filter by status",style:{minWidth:160},value:j,onChange:t=>{U(t),c(1)},children:[e.jsx(i.Option,{value:"pending",children:"Pending"}),e.jsx(i.Option,{value:"confirmed",children:"Confirmed"}),e.jsx(i.Option,{value:"cancelled",children:"Cancelled"})]})]}),P.length===0?e.jsx(M,{image:M.PRESENTED_IMAGE_SIMPLE,description:e.jsxs(S,{orientation:"vertical",size:"small",children:[e.jsx(o,{type:"secondary",children:"No registrations found"}),e.jsx(o,{type:"secondary",style:{fontSize:12},children:"Register your family members for programs to see them here"})]})}):E.length===0?e.jsx(o,{type:"secondary",children:"No registrations match your filters."}):e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:E.map(t=>{const a=I.find(h=>h.id===t.athleteId),p=a?`${a.firstName} ${a.lastName}`.trim():"Unknown Athlete",g=w[t.programId]||"Unknown Program",n=t.status||"pending",l=_[`${t.programId}:${t.athleteId}`];return e.jsx($,{size:"small",style:{cursor:"pointer"},onClick:()=>B(`/register/${t.programId}`),hoverable:!0,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12},children:[e.jsxs("div",{style:{flex:1,minWidth:200},children:[e.jsx("div",{style:{marginBottom:4},children:e.jsx(o,{strong:!0,children:g})}),e.jsx("div",{style:{marginBottom:4},children:e.jsxs(o,{type:"secondary",children:["Athlete: ",p]})}),t.registrationDate&&e.jsx("div",{children:e.jsxs(o,{type:"secondary",style:{fontSize:12},children:["Registered: ",ie(t.registrationDate).format("MMM D, YYYY")]})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:8},children:[e.jsx(N,{icon:q(n),color:J(n),children:n.charAt(0).toUpperCase()+n.slice(1)}),e.jsx(N,{color:l?"blue":"default",children:l?`Assigned: ${l}`:"Unassigned"}),t.totalAmount!==void 0&&e.jsxs(o,{strong:!0,style:{fontSize:16},children:["$",t.totalAmount.toFixed(2)]})]})]})},t.id)})}),u>d&&e.jsx("div",{style:{marginTop:16,textAlign:"center"},children:e.jsxs(S,{children:[e.jsxs(o,{type:"secondary",children:["Showing ",m+1,"-",Math.min(m+d,u)," of ",u]}),f>1&&e.jsx("a",{onClick:()=>c(f-1),children:"Previous"}),m+d<u&&e.jsx("a",{onClick:()=>c(f+1),children:"Next"})]})})]})]})})}export{Ie as default};
