import{o as n,n as c,z as d,t as h,x as p}from"./vendor-firebase-BzUsRx-X.js";import{e as s,q as f,A as u}from"./index-lWfxYzVq.js";const m={parent:"parent",guardian:"guardian",athlete:"athlete",grandparent:"grandparent",relative:"relative",other:"other"},y=["parent","guardian","athlete","grandparent"],g=["relative","other"],v=new Set(Object.values(m));function R(l,t){const e=t||[];if(!e||e.length===0)return Promise.resolve();const r=e.find(o=>!v.has(o));if(r)return Promise.reject(new Error(`Invalid role: ${r}`));if(e.includes("athlete")&&e.length>1)return Promise.reject(new Error("Athlete/Child cannot have other relationships"));const a=e.some(o=>y.includes(o)),i=e.some(o=>g.includes(o));return a&&i?Promise.reject(new Error("Relative/Other cannot be combined with family roles")):Promise.resolve()}const I={async addFamilyFile(l,t){const e=n(s,`familyFiles/${l}`),r=h(e),a={fileName:t.fileName,storagePath:t.storagePath,uploaderId:t.uploaderId,uploadedAt:t.uploadedAt||new Date().toISOString(),size:t.size||null,athleteId:t.athleteId||null,registrationId:t.registrationId||null};await p(r,a);try{await f.log({action:"file.uploaded",entityType:u.File,entityId:r.key,details:a})}catch(i){console.error("Audit log failed for file.uploaded",i)}return r.key},async getFilesByFamily(l){const t=n(s,`familyFiles/${l}`),e=await c(t);if(!e.exists())return[];const r=e.val();return Object.entries(r).map(([a,i])=>({id:a,...i}))},async deleteFamilyFile(l,t){const e=n(s,`familyFiles/${l}/${t}`);try{const r=await c(e),a=r.exists()?r.val():null;await d(e);try{await f.log({action:"file.deleted",entityType:u.File,entityId:t,details:{before:a}})}catch(i){console.error("Audit log failed for file.deleted",i)}}catch(r){console.error("Error deleting file:",r),await d(e)}}};export{I as f,R as v};
